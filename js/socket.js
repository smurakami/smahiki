// Generated by CoffeeScript 1.9.2
(function() {
  var Socket, global;

  Socket = (function() {
    function Socket() {
      this.initWebSocket();
    }

    Socket.prototype.initWebSocket = function() {
      var host, self;
      self = this;
      host = window.document.location.host.replace(/:.*/, '');
      this.ws = new WebSocket('ws://' + host + ':3000');
      this.ws.onmessage = function(event) {
        if (self.received !== null) {
          return self.onmessage(JSON.parse(event.data));
        }
      };
      this.ws.onopen = function() {
        if (self.onopen) {
          return self.onopen();
        }
      };
      this.ws.onerror = function(error) {
        return console.log('WebSocket Error ' + error);
      };
      return this.ws.onclose = function(error) {
        return console.log('WebSocket Error ' + error);
      };
    };

    Socket.prototype.send = function(data) {
      return this.ws.send(JSON.stringify(data));
    };

    Socket.prototype.receive = function(fn) {
      return this.onmessage = fn;
    };

    Socket.prototype.open = function(fn) {
      return this.onopen = fn;
    };

    return Socket;

  })();

  global = this;

  $(function() {
    global.socket = new Socket();
    socket.receive(function(data) {
      return console.log(data);
    });
    socket.open(function() {
      return socket.send({
        event: "location"
      });
    });
    return setInterval(function() {
      console.log('send');
      return socket.send({
        event: "hoge",
        body: {
          hoge: 2
        }
      });
    }, 1000);
  });

}).call(this);
